var ethernetModalWindow,virtualModalWindow,networkingIpv4AddressSelect,$networkingIpv4AddressSelect,address_xhr,netmask_xhr;$(function(){networking.init(),networking.edit(),networking.add_virtual(),networking.char_words_counter(),networking.ethernet_form_validator(),networking.virtual_form_validator()}),networking={init:function(){$(document).ready(function(){ethernetModalWindow=UIkit.modal("#window_ethernet"),virtualModalWindow=UIkit.modal("#window_virtual"),$("a").click(function(){var a=$(this).attr("id").split("-");"edit_ethernet"===a[0]?(ethernetModalWindow.isActive()?ethernetModalWindow.hide():ethernetModalWindow.show(),networking.initIpv4AddressSelect(),$("#window_ethernet_gateway").ipAddress(),$("#window_ethernet_pdns").ipAddress(),$("#window_ethernet_sdns").ipAddress(),$.getJSON("/networking/ethernet/get_edit",{EthernetId:a[1]},function(b){b[0].Status===!0?$("#window_ethernet_status").iCheck("check"):$("#window_ethernet_status").iCheck("uncheck"),$("#window_ethernet_id").val(a[1]),$("#window_ethernet_row").val(a[1]),$("#window_ethernet_title").text(" Ethernet ( "+b[0].Name+" ) "),$("#window_ethernet_desc").val(b[0].Description),b[0].DHCP===!0?$("#window_ethernet_dhcp").iCheck("check"):$("#window_ethernet_dhcp").iCheck("uncheck"),$("#window_ethernet_gateway").val(b[0].Gateway),b[0].ManualDNS===!0?$("#window_ethernet_manualdns").iCheck("check"):$("#window_ethernet_manualdns").iCheck("uncheck"),$("#window_ethernet_pdns").val(b[0].PrimaryDNS),$("#window_ethernet_sdns").val(b[0].SecondaryDNS),$("#window_ethernet_mtu").val(b[0].MTU),b[0].ManualMSS===!0?$("#window_ethernet_manualmss").iCheck("check"):$("#window_ethernet_manualmss").iCheck("uncheck"),$("#window_ethernet_mss").val(b[0].MSS)})):"add_virtualip"===a[0]&&(virtualModalWindow.isActive()?virtualModalWindow.hide():virtualModalWindow.show(),$("#window_virtual_ipv4addr").ipAddress(),$("#window_virtual_netmask").selectize(),$("#window_virtual_parentid").val(a[1]),networking.reloadVirtualList(a[1]))}),$("#window_ethernet_dhcp").on("ifChecked",function(a){$(".dhcp-group").hide(500)}),$("#window_ethernet_dhcp").on("ifUnchecked",function(a){$(".dhcp-group").show(500),$("#window_ethernet_gateway").ipAddress()}),$("#window_ethernet_manualdns").on("ifChecked",function(a){$(".dns-group").show(500),$("#window_ethernet_pdns").ipAddress(),$("#window_ethernet_sdns").ipAddress()}),$("#window_ethernet_manualdns").on("ifUnchecked",function(a){$(".dns-group").hide(500)}),$("#window_ethernet_manualmss").on("ifChecked",function(a){$("#window_ethernet_mss").removeAttr("disabled")}),$("#window_ethernet_manualmss").on("ifUnchecked",function(a){$("#window_ethernet_mss").attr("disabled","disabled")})})},edit:function(){$("#window_ethernet_save").click(function(){var a=$("#window_ethernet_form");if("function"!=typeof a[0].checkValidity||a[0].checkValidity()){$("#window_ethernet_save").addClass("disabled");var b="off";$("#window_ethernet_status").is(":checked")&&(b="on");var c=$("#window_ethernet_row").val(),d=$("#window_ethernet_id").val(),e=$("#window_ethernet_desc").val(),f="off",g=$("#window_ethernet_ipv4addr").val(),h=$("#window_ethernet_netmask").val(),i=$("#window_ethernet_gateway").val();$("#window_ethernet_dhcp").is(":checked")&&(f="on",g="0.0.0.0",h="0.0.0.0",i="0.0.0.0");var j="off",k="0.0.0.0",l="0.0.0.0";$("#window_ethernet_manualdns").is(":checked")&&(j="on",k=$("#window_ethernet_pdns").val(),l=$("#window_ethernet_sdns").val());var m=$("#window_ethernet_mtu").val(),n="off",o="1460";$("#window_ethernet_manualmss").is(":checked")&&(n="on",o=$("#window_ethernet_mss").val()),$.ajax({type:"POST",url:"/networking/ethernet/ethernet_update",data:{EthernetId:d,Status:b,Description:e,DHCP:f,IPv4Address:g,Netmask:h,Gateway:i,ManualDNS:j,PrimaryDNS:k,SecondaryDNS:l,MTU:m,ManualMSS:n,MSS:o},dataType:"json",success:function(a){$("#window_ethernet_save").removeClass("disabled"),ethernetModalWindow.hide(),setTimeout(UIkit.notify({message:a.Message,status:a.Status,timeout:2e3,pos:"top-center"}),5e3),networking.loadTable(c)}})}})},add_virtual:function(){$("#window_virtual_save").click(function(){var a=$("#window_virtual_form");if("function"!=typeof a[0].checkValidity||a[0].checkValidity()){$("#window_virtual_save").addClass("disabled");var b=$("#window_virtual_parentid").val(),c=$("#window_virtual_ipv4addr").val(),d=$("#window_virtual_netmask").val();$.ajax({type:"POST",url:"/networking/ethernet/add_virtual",data:{ParentId:b,IPv4Address:c,Netmask:d},dataType:"json",success:function(a){$("#window_virtual_save").removeClass("disabled"),virtualModalWindow.hide(),setTimeout(UIkit.notify({message:a.Message,status:a.Status,timeout:2e3,pos:"top-center"}),5e3),networking.loadTable(ethernet_row)}})}})},reloadVirtualList:function(a){$("#virtual_ip_list").empty(),$.ajax({type:"GET",url:"/networking/ethernet/get_virtual",data:{ParentId:a},dataType:"json",success:function(a){$.each(a,function(a,b){$("#virtual_ip_list").append('<li id="name" class="uk-nestable-item">'+b.IPv4Address+"/"+b.Netmask+'</li><li class="uk-nestable-item"><a href="#"><i id="del_virtual_ip" class="material-icons">delete</i></a></li>')})}})},loadTable:function(a){a&&$.getJSON("/networking/ethernet/get_edit",{EthernetId:a},function(b){$("#name-"+a).text(b[0].Name),$("#description-"+a).text(b[0].Description),b[0].DHCP?$("#ipv4address-"+a).text("None"):($("#ipv4address-"+a).text(b[0].IPv4Address),$("#netmask-"+a).text(b[0].Netmask));var c="None";b[0].Gateway&&(c=b[0].Gateway),$("#gateway-"+a).text(c);var d="None";b[0].PrimaryDNS&&(d=b[0].PrimaryDNS),$("#primary_dns-"+a).text("DNS Servers: "+b[0].PrimaryDNS);var e="None";b[0].SecondaryDNS&&(e=b[0].SecondaryDNS),$("#secondary_dns-"+a).text(e),$("#mtu-"+a).text(b[0].MTU),$("#mss-"+a).text(b[0].MSS),b[0].Status===!0?($("#status_anchor-"+a).attr("title","Enabled"),$("#status_image-"+a).attr({alt:"Enabled",src:"/static/assets/img/md-images/toggle-switch.png"})):($("#status_anchor-"+a).attr("title","Disabled"),$("#status_image-"+a).attr({alt:"Disabled",src:"/static/assets/img/md-images/toggle-switch-off.png"})),b[0].Link===!0?($("#link_anchor-"+a).attr("title","Connected"),$("#link_image-"+a).attr({alt:"Connected",src:"/static/assets/img/md-images/lan-connect.png"})):($("#dhcp_anchor-"+a).attr("title","Disconnected"),$("#dhcp_image-"+a).attr({alt:"Disconnected",src:"/static/assets/img/md-images/lan-disconnect.png"})),b[0].DHCP===!0?($("#dhcp_anchor-"+a).attr("title","Auto"),$("#dhcp_image-"+a).attr({alt:"Auto",src:"/static/assets/img/md-images/server-network.png"})):($("#dhcp_anchor-"+a).attr("title","Manually"),$("#dhcp_image-"+a).attr({alt:"Manually",src:"/static/assets/img/md-images/server-network-off.png"}))})},initIpv4AddressSelect:function(){var a="(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)";$networkingIpv4AddressSelect=$("#window_ethernet_ipv4addr").selectize({plugins:{remove_button:{label:""}},maxItems:null,valueField:"value",labelField:"name",searchField:["name","value"],options:[],render:{item:function(a,b){return"<div>"+(a.name?'<span class="name">'+b(a.name)+"</span>":"")+(a.value?'<span class="email">'+b(a.value)+"</span>":"")+"</div>"},option:function(a,b){var c=a.name||a.value,d=a.name?a.value:null;return'<div><span class="label">'+b(c)+"</span>"+(d?'<span class="caption">'+b(d)+"</span>":"")+"</div>"}},createFilter:function(b){var c,d;return d=new RegExp("^"+a+"$","i"),(c=b.match(d))?!this.options.hasOwnProperty(c[0]):(d=new RegExp("^([^<]*)<"+a+">$","i"),c=b.match(d),!!c&&!this.options.hasOwnProperty(c[2]))},create:function(b){if(new RegExp("^"+a+"$","i").test(b))return{value:b};var c=b.match(new RegExp("^([^<]*)<"+a+">$","i"));return c?{value:c[2],name:$.trim(c[1])}:(alert("Invalid value address."),!1)},onDropdownOpen:function(a){a.hide().velocity("slideDown",{begin:function(){a.css({"margin-top":"0"})},duration:200,easing:easing_swiftOut})},onDropdownClose:function(a){a.show().velocity("slideUp",{complete:function(){a.css({"margin-top":""})},duration:200,easing:easing_swiftOut})}}),networkingIpv4AddressSelect=$networkingIpv4AddressSelect[0].selectize,networkingIpv4AddressSelect.load(function(a){address_xhr&&address_xhr.abort(),address_xhr=$.ajax({url:"/objects/address/getlist",type:"GET",dataType:"json",success:function(b){a(b)},error:function(){console.log("error has occured!!!"),a()}})})},initNetmaskSelect:function(){$networkingNetmaskSelect=$("#window_ethernet_netmask").selectize({plugins:{remove_button:{label:""}},maxItems:1,valueField:"id",labelField:"title",searchField:"title",create:!1,render:{option:function(a,b){return'<div class="option"><span class="title">'+b(a.title)+"</span></div>"},item:function(a,b){return'<div class="item"><a href="'+b(a.url)+'" target="_blank">'+b(a.title)+"</a></div>"}},onDropdownOpen:function(a){a.hide().velocity("slideDown",{begin:function(){a.css({"margin-top":"0"})},duration:200,easing:easing_swiftOut})},onDropdownClose:function(a){a.show().velocity("slideUp",{complete:function(){a.css({"margin-top":""})},duration:200,easing:easing_swiftOut})}}),networkingNetmaskSelect=$networkingNetmaskSelect[0].selectize,networkingNetmaskSelect.load(function(a){netmask_xhr&&netmask_xhr.abort(),netmask_xhr=$.ajax({url:"/static/data/netmask.json",type:"GET",dataType:"json",success:function(b){a(b)},error:function(){console.log("error has occured!!!"),a()}})})},char_words_counter:function(){var a=$(".input-count");a.length&&(!function(a){"use strict";a.fn.extend({counter:function(b){var c={type:"char",count:"down",goal:140,text:!0,target:!1,append:!0,translation:"",msg:"",container_class:""},d="",e="",f=!1,b=a.extend({},c,b),g={init:function(c){var e=c.attr("id"),f=e+"_count";g.isLimitless(),d=a("<span id="+f+"/>");var h=a("<div/>").attr("id",e+"_counter").append(d).append(" "+g.setMsg());b.container_class&&b.container_class.length&&h.addClass(b.container_class),b.target&&a(b.target).length?b.append?a(b.target).append(h):a(b.target).prepend(h):b.append?h.insertAfter(c):h.insertBefore(c),g.bind(c)},bind:function(a){a.bind("keypress.counter keydown.counter keyup.counter blur.counter focus.counter change.counter paste.counter",g.updateCounter),a.bind("keydown.counter",g.doStopTyping),a.trigger("keydown")},isLimitless:function(){if("sky"===b.goal)return b.count="up",f=!0},setMsg:function(){if(""!==b.msg)return b.msg;if(b.text===!1)return"";if(f)return""!==b.msg?b.msg:"";switch(this.text=b.translation||"character word left max",this.text=this.text.split(" "),this.chars="s ( )".split(" "),this.msg=null,b.type){case"char":b.count===c.count&&b.text?this.msg=this.text[0]+this.chars[1]+this.chars[0]+this.chars[2]+" "+this.text[2]:"up"===b.count&&b.text&&(this.msg=this.text[0]+this.chars[0]+" "+this.chars[1]+b.goal+" "+this.text[3]+this.chars[2]);break;case"word":b.count===c.count&&b.text?this.msg=this.text[1]+this.chars[1]+this.chars[0]+this.chars[2]+" "+this.text[2]:"up"===b.count&&b.text&&(this.msg=this.text[1]+this.chars[1]+this.chars[0]+this.chars[2]+" "+this.chars[1]+b.goal+" "+this.text[3]+this.chars[2])}return this.msg},getWords:function(b){return""!==b?a.trim(b).replace(/\s+/g," ").split(" ").length:0},updateCounter:function(f){var h=a(this);(e<0||e>b.goal)&&g.passedGoal(h),b.type===c.type?b.count===c.count?(e=b.goal-h.val().length,e<=0?d.text("0"):d.text(e)):"up"===b.count&&(e=h.val().length,d.text(e)):"word"===b.type&&(b.count===c.count?(e=g.getWords(h.val()),e<=b.goal?(e=b.goal-e,d.text(e)):d.text("0")):"up"===b.count&&(e=g.getWords(h.val()),d.text(e)))},doStopTyping:function(a){var d=[46,8,9,35,36,37,38,39,40,32];if(g.isGoalReached(a)&&a.keyCode!==d[0]&&a.keyCode!==d[1]&&a.keyCode!==d[2]&&a.keyCode!==d[3]&&a.keyCode!==d[4]&&a.keyCode!==d[5]&&a.keyCode!==d[6]&&a.keyCode!==d[7]&&a.keyCode!==d[8])return b.type!==c.type&&(a.keyCode!==d[9]&&a.keyCode!==d[1]&&b.type!=c.type)},isGoalReached:function(a,d){return!f&&(b.count===c.count?(d=0,e<=d):(d=b.goal,e>=d))},wordStrip:function(b,c){var d=c.replace(/\s+/g," ").split(" ").length;return c=a.trim(c),b<=0||b===d?c:(c=a.trim(c).split(" "),c.splice(b,d,""),a.trim(c.join(" ")))},passedGoal:function(a){var c=a.val();"word"===b.type&&a.val(g.wordStrip(b.goal,c)),"char"===b.type&&a.val(c.substring(0,b.goal)),"down"===b.type&&d.val("0"),"up"===b.type&&d.val(b.goal)}};return this.each(function(){g.init(a(this))})}})}(jQuery),a.each(function(){var a=$(this),b=$(this).attr("maxlength")?$(this).attr("maxlength"):80;a.counter({container_class:"text-count-wrapper",msg:" / "+b,goal:b,count:"up"}),a.closest(".md-input-wrapper").length&&a.closest(".md-input-wrapper").addClass("md-input-wrapper-count")}))},ethernet_form_validator:function(){var a=$("#window_ethernet_form");a.parsley().on("form:validated",function(){altair_md.update_input(a.find(".md-input-danger"))}).on("field:validated",function(a){$(a.$element).hasClass("md-input")&&altair_md.update_input($(a.$element))})},virtual_form_validator:function(){var a=$("#window_virtual_form");a.parsley().on("form:validated",function(){altair_md.update_input(a.find(".md-input-danger"))}).on("field:validated",function(a){$(a.$element).hasClass("md-input")&&altair_md.update_input($(a.$element))})}};